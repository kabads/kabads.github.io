<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Terraform and Loops - creating multiple resources</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=generator content="Hugo 0.89.3">
<link href rel=alternate type=application/rss+xml title=Kabads>
<link href=https://kabads.monkeez.org/css/bootstrap.min.css rel=stylesheet>
<link href=https://kabads.monkeez.org/css/hc.css rel=stylesheet>
<link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet>
<script type=text/javascript>var owa_baseUrl='https://home.monkeez.org/owa/',owa_cmds=owa_cmds||[];owa_cmds.push(['setDebug',!0]),owa_cmds.push(['setSiteId','e96cc79fe81df249b3191b2c920fa8f7']),owa_cmds.push(['trackPageView']),owa_cmds.push(['trackClicks']),function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,owa_baseUrl='https:'==document.location.protocol?window.owa_baseSecUrl||owa_baseUrl.replace(/http:/,'https:'):owa_baseUrl,a.src=owa_baseUrl+'modules/base/js/owa.tracker-combined-min.js',b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)}()</script>
</head>
<body>
<div class=nav-toggle><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
<div id=wrapper>
<div class="navbar navbar-default" role=navigation>
<div class=container>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a href=https://kabads.monkeez.org/><p class=navbar-brand>Kabads</p></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
</ul>
</div>
</div>
</div>
<div id=sidebar-wrapper>
<ul class=sidebar-nav>
<img src>
<li class=sidebar-brand><a href=https://kabads.monkeez.org/><h1 class=brand>Kabads</h1></a><h3></h3></li>
<hr>
<li class=sidebar-brand><a href=../../../about>About</a> </li>
<hr>
<p>
<a href=../../../categories/sysadmin>Sysadmin</a> |
<a href=../../../categories/reading>Reading</a> |
<a href=../../../categories/cycling>Cycling</a> |
<a href=../../../categories/ruby>Ruby</a> |
<a href=../../../categories/emacs>Emacs</a> |
<a href=../../../categories/exercise>Exercise</a> |
<a href=../../../categories/tech>Tech</a> |
<a href=../../../categories/education>Education</a> |
<a href=../../../categories/politics>Politics</a> |
<a href=../../../categories/walking>Walking</a>
</p>
<hr>
<p>To contact, PM me via twitter:</p>
<p><a href=https://twitter.com/kabads>Kabads</a></p>
<hr>
<div id=social-wrapper>
</div>
</ul>
</div>
<div class=container>
<div id=article>
<div class=article-title>Terraform and Loops - creating multiple resources</div>
<p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2019-08-30</small></p> <hr>
<div class=post>
<p>Terraform is a great tool for creating infrastructure. It&rsquo;s almost becoming the &lsquo;de-facto&rsquo; standard. This post will outline how to create multiple resources with just one code block.</p>
<p>The oldest form of looping through a Terraform code block is the <code>count</code> primitive. By defining this, the run of terraform will loop over that resource for the count that has been defined. However, when defining names, the count will need to be used to name the resoure, as follows:</p>
<pre><code>resource &quot;aws_instance&quot; &quot;instance&quot; { 
  count  = 3 
  name   = &quot;web-${count.index}&quot;
  ami    = &quot;ami-1234567&quot; 
}
</code></pre>
<p>This will create three ec2 instances, with names of <code>web-0</code>, <code>web-1</code> and <code>web-3</code>.</p>
<p>Once you use count on a resource, it becomes a list of resources. So in this case <code>aws_instance.instance</code> is now a list of ec2 instances. If you want to refer to one of the instances then you must use the notation <code>aws_instance.instance[0]</code>.</p>
<p>If you wish to refer to all resources in a list, then you will need to use the splat, as in:
<code>aws_instance.instance[*].id</code></p>
<p>Which will return all the ids of the instances created above.</p>
<h2 id=limitations>Limitations</h2>
<p>If you remove items from a list, then the list will rename items. Imagine having instances and then removing the id to one of them. In a list of instances, if you delete the first one (element [0]) from the list variable, instead of deleting that resource, it will remain, but renamed under the second item in the list (element [1]).</p>
</div>
</div>
<a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(a,c,d){var b,e=a.getElementsByTagName(c)[0],f=/^http:/.test(a.location)?'http':'https';a.getElementById(d)||(b=a.createElement(c),b.id=d,b.src=f+'://platform.twitter.com/widgets.js',e.parentNode.insertBefore(b,e))}(document,'script','twitter-wjs')</script>
<ul class=pager>
&nbsp;<li class=previous><a href=https://kabads.monkeez.org/draft/2019-07-29-arrays-with-ruby.html> Ruby Arrays</a></li>
&nbsp;<li class=next><a href=https://kabads.monkeez.org/draft/2019-11-11-how-to-create-virtual-machines-qemu.html> How to Create Virtual Machines With Qemu</a></li>
</ul>
</ul>
</div>
<footer>
<p class="text-muted credit">&copy; 2021. All rights reserved. </p>
</footer>
<script src=https://kabads.monkeez.org/js/jquery-1.10.2.min.js></script>
<script src=https://kabads.monkeez.org/js/bootstrap.min.js></script>
<script src=https://kabads.monkeez.org/js/bootstrap.js></script>
<script type=text/javascript src=https://kabads.monkeez.org/js/hc.js></script>
</body>
</html>