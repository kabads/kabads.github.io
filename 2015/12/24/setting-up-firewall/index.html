<!doctype html><html lang=en><head><meta charset=utf-8><title>Setting up a firewall on Linux Ubuntu 14.04</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.85.0"><link href rel=alternate type=application/rss+xml title=Kabads><link href=https://kabads.monkeez.org/css/bootstrap.min.css rel=stylesheet><link href=https://kabads.monkeez.org/css/hc.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet><script type=text/javascript>var owa_baseUrl='https://home.monkeez.org/owa/',owa_cmds=owa_cmds||[];owa_cmds.push(['setDebug',!0]),owa_cmds.push(['setSiteId','e96cc79fe81df249b3191b2c920fa8f7']),owa_cmds.push(['trackPageView']),owa_cmds.push(['trackClicks']),function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,owa_baseUrl='https:'==document.location.protocol?window.owa_baseSecUrl||owa_baseUrl.replace(/http:/,'https:'):owa_baseUrl,a.src=owa_baseUrl+'modules/base/js/owa.tracker-combined-min.js',b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)}()</script></head><body><div class=nav-toggle><i class="fa fa-bars fa-2x"></i> Herring Cove</div><div id=wrapper><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a href=https://kabads.monkeez.org/><p class=navbar-brand>Kabads</p></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul></div></div></div><div id=sidebar-wrapper><ul class=sidebar-nav><img src><li class=sidebar-brand><a href=https://kabads.monkeez.org/><h1 class=brand>Kabads</h1></a><h3></h3></li><hr><li class=sidebar-brand><a href=../../../../about>About</a></li><hr><p><a href=../../../../categories/sysadmin>Sysadmin</a> |
<a href=../../../../categories/reading>Reading</a> |
<a href=../../../../categories/cycling>Cycling</a> |
<a href=../../../../categories/ruby>Ruby</a> |
<a href=../../../../categories/emacs>Emacs</a> |
<a href=../../../../categories/exercise>Exercise</a> |
<a href=../../../../categories/tech>Tech</a> |
<a href=../../../../categories/education>Education</a> |
<a href=../../../../categories/politics>Politics</a></p><hr><p>To contact, PM me via twitter:</p><p><a href=https://twitter.com/kabads>Kabads</a></p><hr><div id=social-wrapper></div></ul></div><div class=container><div id=article><div class=article-title>Setting up a firewall on Linux Ubuntu 14.04</div><p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2015-12-24</small></p><hr><div class=post><p>This post walks throug the steps needed to set up a firewall on Ubuntu 14.04. Note that 14.04 is now end of life.</p><h2 id=uses>Uses</h2><p>Firewalls allow only particular access to particular network ports and paths. You can remove access to a port or a specific IP address or a range of IP addresses.</p><p>Admins can apply rules according to what access they would like - these rules include both outgoing and incoming network traffic. This allows admins to build barriers of trust across machines.</p><p>Modern firewalls are based on <a href=https://en.wikipedia.org/wiki/Application_firewall><em>Application Layer Firewalls</em></a> and are aware of the kinds of applications and protocols that the connection is using. They can block anything which is not part of the normal flow of traffic.</p><h2 id=set-up>Set up</h2><p>The <strong>firewalld</strong> package needs to be installed:</p><pre><code>$ sudo aptitude install firewalld 
</code></pre><p>You should not run the program <strong>iptables</strong> alongside <strong>firewalld</strong> as this is the older version and will create a conflict.</p><p><strong>firewalld</strong> is a service which needs to be running to use and configure the firewall, and is started in the usual way.</p><pre><code>$ sudo /etc/init.d/firewalld start 
</code></pre><p>You can test if the service is running with:</p><pre><code>$ sudo firewall-cmd --state
</code></pre><p>If you have more than one network interface on IPV4, you will need to turn on <strong>ip forwarding</strong>. This is achieved with:</p><pre><code>$ sudo sysctl net.ipv4.ip_forward=1
</code></pre><p>However, this is not persistent across boots. To achieve this, you will need to add the following line to <em>/etc/sysctl.conf</em>:</p><pre><code>net.ipv4.ip_forward=1 
</code></pre><p>and then reboot or type:</p><pre><code>$ sudo sysctl -p 
</code></pre><p>to read in the new setting.</p><h3 id=zones>Zones</h3><p>Firewalls work with <strong>zones</strong> each which has a level of trust defined. The zones are</p><ul><li><strong>drop</strong> - only particular incoming connections are allowed</li><li><strong>block</strong> - all incoming connections are rejected</li><li><strong>public</strong> - do not trust any computers on the network; only defined incoming connections are permitted</li><li><strong>external</strong> - used when <em>masquerading</em> is being used, usually in routers.</li><li><strong>dmz</strong> - used when access is allowed only to some services to the public.</li><li><strong>work</strong> - trust connected nodes to be not harmful</li><li><strong>home</strong> - mostly trust other network nodes, but still select which incoming connections are allowed</li><li><strong>internal</strong> - similar to work zone</li><li><strong>trusted</strong> - everything is allowed.</li></ul><p>On installation, nearly all Linux distributions will select the <strong>public</strong> zone as the default for all interfaces.</p><p>Get the default zone:</p><pre><code>$ sudo firewall-cmd --get-default-zone
</code></pre><p>Obtain a list of zones being used:</p><pre><code>$ sudo firewall-cmd --get-active-zones 
</code></pre><p>List all available zones:</p><pre><code>$ sudo firewall-cmd --get-zones 
</code></pre><p>To change the default zone to <strong>trusted</strong> and then change it back.</p><pre><code>$ sudo firewall-cmd --set-default-zone=trusted

$ sudo firewall-cmd --set-default-zone=public
</code></pre><p>To assign an interface temporarily to a particular zone:</p><pre><code>$ sudo firewall-cmd --zone=internal --change-interface=eth0
</code></pre><p>This will only change the interface until the next boot. To make it permanent, we add the <strong>&ndash;permanent</strong> flag.</p><pre><code>$ sudo firewall-cmd --permanent --zone=internal --change-interface=eth0
</code></pre><p>which will create a file in <strong>/etc/firewalld/zones/internal.xml</strong>.</p><p>To ascertain the zone associated with a particular interface:</p><pre><code>$ sudo firewall-cmd --get-zone-of-interface=eth0
</code></pre><p>To get the details of a particular zone:</p><pre><code>$ sudo firewall-cmd --zone=public --list-all 
</code></pre><p>An admin can also bind a zone to a network address (as well as an interface).</p><p>To bind a source to a zone:</p><pre><code>$ sudo firewall-cmd --permanent --zone=trusted --add-source=192.168.1.0/24
</code></pre><p>With this command, anyone from address 192.168.1.x will be added to the <strong>trusted</strong> zone.</p><h3 id=services-and-ports-within-a-zone>Services and ports within a zone</h3><p>Setting zones is now possible, but for these to become effective, we need to set particular services within each zone.</p><p>We can see what services are associated with a particular zone:</p><pre><code>$ sudo firewall-cmd --list-services --zone=public
</code></pre><p>To add a service to a zone:</p><pre><code>$ sudo firewall-cmd --permanent --zone=work --add-service=http
$ sudo firewall-cmd --reload 
</code></pre><p><strong>&ndash;reload</strong> is required to make the change effective and <strong>&ndash;permanent</strong> is required to add a service to a zone.</p><p>Port management is very similar:</p><pre><code>$ sudo firewall-cmd --zone=work --add-port=21/tcp
$ sudo firewall-cmd --reload 
</code></pre><p>You can also remove these with the commands <strong>&ndash;remove-service</strong> and <strong>&ndash;remove-port</strong>.</p></div></div><a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(a,c,d){var b,e=a.getElementsByTagName(c)[0],f=/^http:/.test(a.location)?'http':'https';a.getElementById(d)||(b=a.createElement(c),b.id=d,b.src=f+'://platform.twitter.com/widgets.js',e.parentNode.insertBefore(b,e))}(document,'script','twitter-wjs')</script><ul class=pager>&nbsp;<li class=previous><a href=https://kabads.monkeez.org/2015/12/22/how-to-enable-disk-quotas-linux/>How to enable disk quotas for users</a></li>&nbsp;<li class=next><a href=https://kabads.monkeez.org/2016/01/24/bash-find-command/>Bash find command</a></li></ul></ul></div><footer><p class="text-muted credit">&copy; 2021. All rights reserved.</p></footer><script src=https://kabads.monkeez.org/js/jquery-1.10.2.min.js></script><script src=https://kabads.monkeez.org/js/bootstrap.min.js></script><script src=https://kabads.monkeez.org/js/bootstrap.js></script><script type=text/javascript src=https://kabads.monkeez.org/js/hc.js></script></body></html>