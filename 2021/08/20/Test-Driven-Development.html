<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Test Driven Development</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=generator content="Hugo 0.89.2">
<link href rel=alternate type=application/rss+xml title=Kabads>
<link href=https://kabads.monkeez.org/css/bootstrap.min.css rel=stylesheet>
<link href=https://kabads.monkeez.org/css/hc.css rel=stylesheet>
<link href=//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css rel=stylesheet>
<script type=text/javascript>var owa_baseUrl='https://home.monkeez.org/owa/',owa_cmds=owa_cmds||[];owa_cmds.push(['setDebug',!0]),owa_cmds.push(['setSiteId','e96cc79fe81df249b3191b2c920fa8f7']),owa_cmds.push(['trackPageView']),owa_cmds.push(['trackClicks']),function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,owa_baseUrl='https:'==document.location.protocol?window.owa_baseSecUrl||owa_baseUrl.replace(/http:/,'https:'):owa_baseUrl,a.src=owa_baseUrl+'modules/base/js/owa.tracker-combined-min.js',b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)}()</script>
</head>
<body>
<div class=nav-toggle><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
<div id=wrapper>
<div class="navbar navbar-default" role=navigation>
<div class=container>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a href=https://kabads.monkeez.org/><p class=navbar-brand>Kabads</p></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
</ul>
</div>
</div>
</div>
<div id=sidebar-wrapper>
<ul class=sidebar-nav>
<img src>
<li class=sidebar-brand><a href=https://kabads.monkeez.org/><h1 class=brand>Kabads</h1></a><h3></h3></li>
<hr>
<li class=sidebar-brand><a href=../../../about>About</a> </li>
<hr>
<p>
<a href=../../../categories/sysadmin>Sysadmin</a> |
<a href=../../../categories/reading>Reading</a> |
<a href=../../../categories/cycling>Cycling</a> |
<a href=../../../categories/ruby>Ruby</a> |
<a href=../../../categories/emacs>Emacs</a> |
<a href=../../../categories/exercise>Exercise</a> |
<a href=../../../categories/tech>Tech</a> |
<a href=../../../categories/education>Education</a> |
<a href=../../../categories/politics>Politics</a> |
<a href=../../../categories/walking>Walking</a>
</p>
<hr>
<p>To contact, PM me via twitter:</p>
<p><a href=https://twitter.com/kabads>Kabads</a></p>
<hr>
<div id=social-wrapper>
</div>
</ul>
</div>
<div class=container>
<div id=article>
<div class=article-title>Test Driven Development</div>
<p class=meta><small>&nbsp;<i class="fa fa-calendar-o"></i> 2021-08-20</small></p> <hr>
<div class=post>
<p>So, I started learning <a href=https://golang.org>Golang</a> recently, and decided that <a href=https://quii.gitbook.io/learn-go-with-tests/>Learn Go with Tests</a> was a good way to go. However, there was a great &lsquo;buy-one-get-one-free&rsquo; with this resource - it also taught me some of the benefits of Test Driven Development (TDD). There are four steps to TDD:</p>
<ul>
<li>Write the test</li>
<li>Write a minimal amount of code for the test to recognise the code (e.g. write the function and just return - the test should still fail)</li>
<li>Write the function correctly to return the expected output</li>
<li>Refactor (change the code to better represent the test case)</li>
</ul>
<p>I&rsquo;m not using Go that much at work, with <a href=https://python.org>Python</a> being the dominant language (for now). This meant I had to learn how to use tests in Python. This blog post represents my learning and notes.</p>
<h3 id=install-pytest>Install Pytest</h3>
<p>Pytest does not come with the standard library, so does require an install.</p>
<p>To install <code>pytest</code>, you just run <code>pip install -u pytest</code>.</p>
<h3 id=write-the-test>Write the test</h3>
<p>So, my initial test was to just add two numbers together:</p>
<pre><code>from src.add import add

def test_add():
    assert add(5, 7) == 12
</code></pre>
<p>Here, the code asserts that if I pass <code>5</code> and <code>7</code> to my <code>add</code> function, the function will return <code>12</code>. If this returns anything different, then the test will fail.</p>
<h4 id=directory-structure>Directory Structure</h4>
<p>This is within a <code>tests</code> directory.</p>
<p>My project file structure is thus:</p>
<pre><code>project/
     | 
	 |- src
     |
     |- tests
</code></pre>
<p>The initial problem that needs to be solved is that the test needs to import the add module. To help with this, we need to add <code>__init__.py</code> files to the src directory</p>
<p>The initial problem that needs to be solved is that the test needs to import the add module. To help with this, we need to add <code>__init__.py</code> files to the <code>src</code> and <code>tests</code> directory. So this is how the file structure looks now:</p>
<pre><code>project/
     | 
	 |- src
     |    |- __init__.py
     |- tests
          |- test_add.py
          |- __init__.py
</code></pre>
<p>However, the import will still not work. You will need a <code>setup.py</code> file in the top directory to help with that:</p>
<pre><code>from setuptools import setup, find_packages

setup(name=&quot;add&quot;, packages=find_packages())
</code></pre>
<p>This file needs to be at the project level:</p>
<pre><code>project/
     |- setup.py
	 |- src
     |    |- __init__.py
     |- tests
          |- test_add.py
          |- __init__.py
</code></pre>
<p>The important part of the process now is that you run the test to prove that it fails. Run <code>pytest</code> in the project directory. Pytest automatically looks for directories and files that start with <code>test</code>:</p>
<pre><code>================================================= test session starts =================================================
platform win32 -- Python 3.9.6, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: C:\Users\adamc\Documents\test
plugins: anyio-3.3.0
collected 0 items / 1 error

======================================================= ERRORS ========================================================
_________________________________________ ERROR collecting tests/test_add.py __________________________________________
importError while importing test module 'C:\Users\adamc\Documents\test\tests\test_add.py'.
hint: make sure your test modules/packages have valid Python names.
traceback:
..\..\appdata\local\programs\python\python39\lib\importlib\__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
tests\test_add.py:1: in &lt;module&gt;
    from src.add import add
e   ModuleNotFoundError: No module named 'src.add'
=============================================== short test summary info ===============================================
eRROR tests/test_add.py
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
================================================== 1 error in 0.21s ===================================================
</code></pre>
<p>This proves that the error is failing.</p>
<p>Then we need to create the file in the <code>src</code> directory to help this pass. Even at the moment, the import is not finding the <code>src</code> directory, which needs to be fixed.</p>
<h3 id=write-the-minimal-amount-of-code>Write the minimal amount of code</h3>
<p>We need a file <code>add.py</code> in the <code>src</code> directory. The first iteration of the file we can add is just a function that returns:</p>
<pre><code>def add():
    return
</code></pre>
<p>This will change the nature of the test - it will run, but will now fail properly:</p>
<pre><code>================================================= test session starts =================================================
platform win32 -- Python 3.9.6, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: C:\Users\adamc\Documents\test
plugins: anyio-3.3.0
collected 1 item

tests\test_add.py F                                                                                              [100%]

====================================================== FAILURES =======================================================
______________________________________________________ test_add _______________________________________________________

    def test_add():
&gt;       assert add(5, 7) == 12
E       TypeError: add() takes 0 positional arguments but 2 were given

tests\test_add.py:4: TypeError
=============================================== short test summary info ===============================================
FAILED tests/test_add.py::test_add - TypeError: add() takes 0 positional arguments but 2 were given
================================================== 1 failed in 0.24s ==================================================
</code></pre>
<p>So, pytest is now importing the function, and passing in <code>5</code> and <code>7</code> parameters, but only getting a return (the function doesn&rsquo;t accept any values at the moment).</p>
<p>Let&rsquo;s fix that:</p>
<pre><code>def add(x, y):
    return x + y
</code></pre>
<p>If we run <code>pytest</code> we now get:</p>
<pre><code>================================================= test session starts =================================================
platform win32 -- Python 3.9.6, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: C:\Users\adamc\Documents\test
plugins: anyio-3.3.0
collected 1 item

tests\test_add.py .                                                                                              [100%]

================================================== 1 passed in 0.06s ==================================================
</code></pre>
<p>The good news here is the <code>tests\test_add.py .</code> section - specifically the <code>.</code> character. This outlines that the test passed.</p>
<h3 id=refactor-the-code>Refactor the code</h3>
<p>This function is very simple and doesn&rsquo;t need any refactoring. It might be that my test needs refactoring, or my code needs refactoring. Here this isn&rsquo;t necessary, but it might be that there is some duplication in my code, or that I need to change a special case (for example, divide by zero).</p>
<h3 id=summary>Summary</h3>
<p>This is just an introduction to testing. There are many more ways tests can be &lsquo;named&rsquo; and then run, but this just aims to get a simple test suite up and running. For more information, consult the <a href=https://docs.pytest.org/en/6.2.x/>pytest documentation</a>.</p>
</div>
</div>
<a href=https://twitter.com/share class=twitter-share-button data-size=small data-count=none>Tweet</a>
<script>!function(a,c,d){var b,e=a.getElementsByTagName(c)[0],f=/^http:/.test(a.location)?'http':'https';a.getElementById(d)||(b=a.createElement(c),b.id=d,b.src=f+'://platform.twitter.com/widgets.js',e.parentNode.insertBefore(b,e))}(document,'script','twitter-wjs')</script>
<ul class=pager>
&nbsp;<li class=previous><a href=https://kabads.monkeez.org/2021/03/28/JWT-Authentication-with-Salesforce.html> JWT Authentication with Salesforce</a></li>
&nbsp;<li class=next><a href=https://kabads.monkeez.org/2021/09/11/Gilbert-Whites-Zig-Zag-Walk.html> Gilbert White's Zig-Zag Walk</a></li>
</ul>
</ul>
</div>
<footer>
<p class="text-muted credit">&copy; 2021. All rights reserved. </p>
</footer>
<script src=https://kabads.monkeez.org/js/jquery-1.10.2.min.js></script>
<script src=https://kabads.monkeez.org/js/bootstrap.min.js></script>
<script src=https://kabads.monkeez.org/js/bootstrap.js></script>
<script type=text/javascript src=https://kabads.monkeez.org/js/hc.js></script>
</body>
</html>